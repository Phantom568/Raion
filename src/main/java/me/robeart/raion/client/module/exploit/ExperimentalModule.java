package me.robeart.raion.client.module.exploit;

import com.google.common.collect.Maps;
import me.robeart.raion.client.events.EventStageable;
import me.robeart.raion.client.events.events.network.PacketReceiveEvent;
import me.robeart.raion.client.events.events.network.PacketSendEvent;
import me.robeart.raion.client.module.Module;
import net.minecraft.enchantment.Enchantment;
import net.minecraft.enchantment.EnchantmentHelper;
import net.minecraft.init.Enchantments;
import net.minecraft.init.Items;
import net.minecraft.item.ItemStack;
import net.minecraft.network.play.client.CPacketClickWindow;
import team.stiff.pomelo.impl.annotated.handler.annotation.Listener;

import java.util.Map;

public class ExperimentalModule extends Module {
	
	public ExperimentalModule() {
		super("Experimental", "Test123", Category.EXPLOIT);
	}
	
	@Override
	public void onEnable() {
	}
	
	@Listener
	public void onPacketReceive(PacketReceiveEvent event) {
		if (event.getStage() != EventStageable.EventStage.PRE) return;
	}
	
	
	@Listener
	public void onPacketSend(PacketSendEvent event) {
		if (event.getStage() != EventStageable.EventStage.PRE) return;
		if(event.getPacket() instanceof CPacketClickWindow) {
			CPacketClickWindow packet = (CPacketClickWindow) event.getPacket();
			ItemStack item = mc.player.inventoryContainer.getSlot(packet.getSlotId()).getStack();
			if(EnchantmentHelper.getEnchantmentLevel(Enchantments.SHARPNESS, item) >= 1000) {
				Map<Enchantment, Integer> map = Maps.<Enchantment, Integer>newLinkedHashMap();
				map.put(Enchantments.SHARPNESS, 5);
				map.put(Enchantments.KNOCKBACK, 2);
				map.put(Enchantments.FIRE_ASPECT, 2);
				map.put(Enchantments.LOOTING, 3);
				map.put(Enchantments.SWEEPING, 3);
				map.put(Enchantments.UNBREAKING, 3);
				map.put(Enchantments.MENDING, 1);
				map.put(Enchantments.VANISHING_CURSE, 1);
				EnchantmentHelper.setEnchantments(map, item);
				event.setCanceled(true);
				System.out.println("sending fake");
				mc.player.connection.sendPacket(new CPacketClickWindow(packet.getWindowId(), packet.getSlotId(), packet.getUsedButton(), packet.getClickType(), ItemStack.EMPTY, packet.getActionNumber()));
			}
			System.out.println(EnchantmentHelper.getEnchantments(item));
		}
	}
	
	
}
